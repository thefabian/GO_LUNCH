<h1>Inbox</h1>

</ul>
<div class="row">
  <div class="col-md-8">
    <ul class="list-group">
      <% @conversations.each do |conversation| %>
        <li class="list-group-item" data-conversation="<%= conversation.id %>">
          <%= link_to conversation.recipient(current_user).email, conversation_messages_path(conversation) %>
          <% if !conversation.unread_message_count(current_user).zero? %>
            <span class="badge"><%= conversation.unread_message_count(current_user) %></span>
          <% end %>
        </li>

        <div class="newcontainer n<%= conversation.id %>">
  <div class="messaging">
    <div class="inbox_msg">
      <div class="inbox_people">
        <div class="mesgs profile-page">
          <div class="msg_history">
            <% conversation.messages.each do |message| %>
            <% if message.body %>
            <div class=" <%= message.user == current_user ? "incoming_msg " : "outgoing_msg" %>">
              <div class=" <%= message.user == current_user ? "incoming_msg_img" : " outgoing_msg_img" %>">
                <% if message.user == current_user %>
                <%= cl_image_tag(current_user.profile.photo, :transformation=>[{:width=>1200, :height=>1200, :gravity=>"face", :radius=>"max", :crop=>"crop"},]) %>
                <% else %>
                <%= cl_image_tag(@other_user.profile.photo, :transformation=>[{:width=>1200, :height=>1200, :gravity=>"face", :radius=>"max", :crop=>"crop"},]) %>
                <% end %>
              </div>
            </div>
            <div class=" <%= message.user == current_user ? "outgoing_msg" : "received_msg" %>">
              <div class=" <%= message.user == current_user ? "sent_msg" : "received_withd_msg" %>">

                <p><%= message.body %></p>
                <p><%= message.user.email%></p>
                <% end %>
              </div>
            </div>
            <% end %>
          </div>
        </div>
        <div class="type_msg">
          <%= form_for [conversation, @message] do |f| %>
          <div class="input_msg_write">
            <%= f.text_area :body, autofocus: true,class: "form-control text-right", id: "exampleFormControlTextarea1", rows: "3" ,placeholder: "Type a message"%>
          </div>
          <%= f.submit "send",remote: true, class: "btn btn-primary float-right", value: "Submit"%>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
      <% end %>
    </ul>













  </div>
  <div class="col-md-4">
    <div class="form-group">
    </div>
    <ul id="users" class="list-group">
      <% @users.each do |user| %>
          <li class="list-group-item" data-searchstring="<%= user.email %>">
            <%= button_to user.email, conversations_path(sender_id: current_user.id, receiver_id: user.id), method: :post, remote: true %>
          </li>
      <% end %>
    </ul>
  </div>
<div id="messagescontainer"></div>
</div>


<script>
  document.querySelectorAll(".list-group-item").forEach(function(element) {
  console.log(element);
  element.addEventListener("click", (event) => {
    event.preventDefault;
    const a = event.currentTarget.getAttribute("data-conversation");
    const selector = ".n" + a
    document.querySelector(selector).classList.toggle("hidden");

  })
});

</script>



